<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企業相關</title>
    <link rel="stylesheet" href="/public/css/enterprise-related.css">
    <style>
        a {
            text-decoration: none;
            color: #007bff;
        }
        a:hover {
            text-decoration: underline;
        }
        img {
            max-width: 100px;
            max-height: 100px;
        }
        .pagination button {
            margin: 0 2px;
            padding: 5px 10px;
            border: none;
            background-color: #e0e0e0;
            cursor: pointer;
            color: #333;
        }
        .pagination button:hover {
            background-color: #c0c0c0;
        }
        .pagination .current-page {
            font-weight: bold;
            background-color: #004085;
            color: white;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 80px;
            height: 30px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: red;
            transition: .4s;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .slider:before {
            content: "上架";
            order: 2;
            margin-left: 5px;
        }

        .slider:after {
            content: "";
            position: absolute;
            left: 2px;
            bottom: 2px;
            height: 26px;
            width: 26px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: green;
            justify-content: space-between;
        }

        input:checked + .slider:before {
            content: "下架";
            order: 1;
            margin-left: 0;
            margin-right: 5px;
        }

        input:checked + .slider:after {
            transform: translateX(50px);
        }
    </style>
</head>
<body>
    <h1>公告管理-企業相關</h1>
    <h2>預設編輯時間排序，新的在上</h2>
    <div>
        <button onclick="location.href='announcement-form.html'">新增</button>
        <button onclick="history.back()">回上一頁</button>
    </div>
    <div>
        <table>
            <thead>
                <tr>
                    <th>上架</th>
                    <th>公告標題</th>
                    <th>上架時間</th>
                    <th>下架時間</th>
                    <th>封面縮圖</th>
                </tr>
            </thead>
            <tbody id="announcements-body">
                <!-- 這裡將動態生成公告內容 -->
            </tbody>
        </table>
    </div>
    <div id="pagination" class="pagination">
        <!-- 這裡將動態生成分頁按鈕 -->
    </div>
    <script>
        let currentPage = 1;

        function toggleEnable(announcementId, currentEnable) {
            const newEnable = !currentEnable;

            fetch(`http://localhost:3001/api/announcements/${announcementId}/enable`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enable: newEnable }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                loadAnnouncements(currentPage); // 重新加載公告列表
            })
            .catch(error => {
                console.error('Error:', error);
                alert('更新上架狀態時出錯');
            });
        }

        function loadAnnouncements(page) {
            fetch(`http://localhost:3001/api/announcements?page=${page}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const tbody = document.getElementById('announcements-body');
                    tbody.innerHTML = ''; // 清空現有的公告

                    data.announcements.forEach(announcement => {
                        const row = document.createElement('tr');

                        const enableCell = document.createElement('td');
                        const switchLabel = document.createElement('label');
                        switchLabel.className = 'switch';
                        const enableSwitch = document.createElement('input');
                        enableSwitch.type = 'checkbox';
                        enableSwitch.checked = announcement.enable;
                        enableSwitch.onchange = () => toggleEnable(announcement.id, announcement.enable);
                        const slider = document.createElement('span');
                        slider.className = 'slider';
                        switchLabel.appendChild(enableSwitch);
                        switchLabel.appendChild(slider);
                        enableCell.appendChild(switchLabel);
                        row.appendChild(enableCell);

                        const titleCell = document.createElement('td');
                        const titleLink = document.createElement('a');
                        titleLink.href = `announcement-form.html?id=${announcement.id}`;
                        titleLink.textContent = announcement.title;
                        titleCell.appendChild(titleLink);
                        row.appendChild(titleCell);

                        const timeOnCell = document.createElement('td');
                        timeOnCell.textContent = announcement.timeOn;
                        row.appendChild(timeOnCell);

                        const timeOffCell = document.createElement('td');
                        timeOffCell.textContent = announcement.timeOff;
                        row.appendChild(timeOffCell);

                        const imageCell = document.createElement('td');
                        if (announcement.image) {
                            const img = document.createElement('img');
                            img.src = `http://localhost:3001/uploads/${announcement.image}`;
                            imageCell.appendChild(img);
                        }
                        row.appendChild(imageCell);

                        tbody.appendChild(row);
                    });

                    const pagination = document.getElementById('pagination');
                    pagination.innerHTML = ''; // 清空現有的分頁按鈕

                    for (let i = 1; i <= data.totalPages; i++) {
                        const button = document.createElement('button');
                        button.textContent = i;
                        button.onclick = () => loadAnnouncements(i);
                        if (i === data.currentPage) {
                            button.classList.add('current-page');
                        }
                        pagination.appendChild(button);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('加載公告時出錯');
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadAnnouncements(currentPage);
        });
    </script>
</body>
</html>

